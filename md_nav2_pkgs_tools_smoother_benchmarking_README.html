<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Auto OS: Planners Smoothing Benchmark</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Auto OS
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Planners Smoothing Benchmark </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This experiment runs a set with randomly generated goals for objective benchmarking.</p>
<p>Bechmarking scripts require the following python packages to be installed:</p>
<div class="fragment"><div class="line">pip install transforms3d</div>
<div class="line">pip install seaborn</div>
<div class="line">pip install tabulate</div>
</div><!-- fragment --><p>To use the suite, modify the Nav2 bringup parameters <code>nav2_params.yaml</code> to include selected path planner:</p>
<div class="fragment"><div class="line">planner_server:</div>
<div class="line">  ros__parameters:</div>
<div class="line">    expected_planner_frequency: 20.0</div>
<div class="line">    planner_plugins: [&quot;SmacHybrid&quot;]</div>
<div class="line">    SmacHybrid:</div>
<div class="line">      plugin: &quot;nav2_smac_planner::SmacPlannerHybrid&quot;</div>
<div class="line">      tolerance: 0.5</div>
<div class="line">      motion_model_for_search: &quot;DUBIN&quot; # default, non-reverse motion</div>
<div class="line">      smooth_path: false # should be disabled for experiment</div>
<div class="line">      analytic_expansion_max_length: 0.3 # decreased to avoid robot jerking</div>
</div><!-- fragment --><p>... and path smoothers for benchmark:</p>
<div class="fragment"><div class="line">smoother_server:</div>
<div class="line">  ros__parameters:</div>
<div class="line">   smoother_plugins: [&quot;simple_smoother&quot;, &quot;constrained_smoother&quot;, &quot;sg_smoother&quot;]</div>
<div class="line">   simple_smoother:</div>
<div class="line">     plugin: &quot;nav2_smoother::SimpleSmoother&quot;</div>
<div class="line">   constrained_smoother:</div>
<div class="line">     plugin: &quot;nav2_constrained_smoother/ConstrainedSmoother&quot;</div>
<div class="line">     w_smooth: 100000.0 # tuned</div>
<div class="line">   sg_smoother:</div>
<div class="line">     plugin: &quot;nav2_smoother::SavitzkyGolaySmoother&quot;</div>
</div><!-- fragment --><p>Set global costmap, path planner and smoothers parameters to those desired in <code>nav2_params.yaml</code>. Inside of <code>metrics.py</code>, you can change reference path planner / path smoothers to use.</p>
<p>For the benchmarking purposes, the clarification of execution time may be made for planner and smoother servers, to reduce impacts caused by other system actions outside of the planning / smoothing algorithm (optional):</p>
<div class="fragment"><div class="line">diff --git a/nav2_planner/src/planner_server.cpp b/nav2_planner/src/planner_server.cpp</div>
<div class="line">index c7a90bcb..6f93edbf 100644</div>
<div class="line">--- a/nav2_planner/src/planner_server.cpp</div>
<div class="line">+++ b/nav2_planner/src/planner_server.cpp</div>
<div class="line">@@ -381,7 +381,10 @@ void PlannerServer::computePlanThroughPoses()</div>
<div class="line">       }</div>
<div class="line"> </div>
<div class="line">       // Get plan from start -&gt; goal</div>
<div class="line">+      auto planning_start = steady_clock_.now();</div>
<div class="line">       nav_msgs::msg::Path curr_path = getPlan(curr_start, curr_goal, goal-&gt;planner_id);</div>
<div class="line">+      auto planning_duration = steady_clock_.now() - planning_start;</div>
<div class="line">+      result-&gt;planning_time = planning_duration;</div>
<div class="line"> </div>
<div class="line">       if (!validatePath&lt;ActionThroughPoses&gt;(curr_goal, curr_path, goal-&gt;planner_id)) {</div>
<div class="line">         throw nav2_core::NoValidPathCouldBeFound(goal-&gt;planner_id + &quot;generated a empty path&quot;);</div>
<div class="line">@@ -398,7 +401,7 @@ void PlannerServer::computePlanThroughPoses()</div>
<div class="line">     publishPlan(result-&gt;path);</div>
<div class="line"> </div>
<div class="line">     auto cycle_duration = steady_clock_.now() - start_time;</div>
<div class="line">-    result-&gt;planning_time = cycle_duration;</div>
<div class="line">+    // result-&gt;planning_time = cycle_duration;</div>
<div class="line"> </div>
<div class="line">     if (max_planner_duration_ &amp;&amp; cycle_duration.seconds() &gt; max_planner_duration_) {</div>
<div class="line">       RCLCPP_WARN(</div>
<div class="line">diff --git a/nav2_smoother/src/nav2_smoother.cpp b/nav2_smoother/src/nav2_smoother.cpp</div>
<div class="line">index ada1f664..610e9512 100644</div>
<div class="line">--- a/nav2_smoother/src/nav2_smoother.cpp</div>
<div class="line">+++ b/nav2_smoother/src/nav2_smoother.cpp</div>
<div class="line">@@ -253,8 +253,6 @@ bool SmootherServer::findSmootherId(</div>
<div class="line"> </div>
<div class="line"> void SmootherServer::smoothPlan()</div>
<div class="line"> {</div>
<div class="line">-  auto start_time = steady_clock_.now();</div>
<div class="line">-</div>
<div class="line">   RCLCPP_INFO(get_logger(), &quot;Received a path to smooth.&quot;);</div>
<div class="line"> </div>
<div class="line">   auto result = std::make_shared&lt;Action::Result&gt;();</div>
<div class="line">@@ -271,6 +269,8 @@ void SmootherServer::smoothPlan()</div>
<div class="line">     // Perform smoothing</div>
<div class="line">     auto goal = action_server_-&gt;get_current_goal();</div>
<div class="line">     result-&gt;path = goal-&gt;path;</div>
<div class="line">+</div>
<div class="line">+    auto start_time = steady_clock_.now();</div>
<div class="line">     result-&gt;was_completed = smoothers_[current_smoother_]-&gt;smooth(</div>
<div class="line">       result-&gt;path, goal-&gt;max_smoothing_duration);</div>
<div class="line">     result-&gt;smoothing_duration = steady_clock_.now() - start_time;</div>
</div><!-- fragment --><p>Then execute the benchmarking:</p>
<ul>
<li><code>ros2 launch ./smoother_benchmark_bringup.py</code> to launch the nav2 stack and path smoothers benchmarking</li>
<li><code>python3 ./process_data.py</code> to take the metric files and process them into key results (and plots) </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
