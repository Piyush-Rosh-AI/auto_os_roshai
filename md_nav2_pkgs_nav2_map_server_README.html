<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Auto OS: Map Server</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Auto OS
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Map Server </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <code>Map Server</code> provides maps to the rest of the Nav2 system using both topic and service interfaces. Map server will expose maps on the node bringup, but can also change maps using a <code>load_map</code> service during run-time, as well as save maps using a <code>save_map</code> server.</p>
<p>See its <a href="https://docs.nav2.org/configuration/packages/configuring-map-server.html">Configuration Guide Page</a> for additional parameter descriptions.</p>
<h2><a class="anchor" id="autotoc_md139"></a>
Architecture</h2>
<p>In contrast to the ROS1 navigation map server, the nav2 map server will support a variety of map types, and thus some aspects of the original code have been refactored to support this new extensible framework.</p>
<p>Currently map server divides into tree parts:</p>
<ul>
<li><code>map_server</code></li>
<li><code>map_saver</code></li>
<li><code>map_io</code> library</li>
</ul>
<p><code>map_server</code> is responsible for loading the map from a file through command-line interface or by using service requests.</p>
<p><code>map_saver</code> saves the map into a file. Like <code>map_server</code>, it has an ability to save the map from command-line or by calling a service.</p>
<p><code>map_io</code> - is a map input-output library. The library is designed to be an object-independent in order to allow easily save/load map from external code just by calling necessary function. This library is also used by <code>map_loader</code> and <code>map_saver</code> to work. Currently it contains OccupancyGrid saving/loading functions moved from the rest part of map server code. It is designed to be replaceable for a new IO library (e.g. for library with new map encoding method or any other library supporting costmaps, multifloor maps, etc...).</p>
<h2><a class="anchor" id="autotoc_md140"></a>
CLI-usage</h2>
<h3><a class="anchor" id="autotoc_md141"></a>
Map Server</h3>
<p>The <code>Map Server</code> is a composable ROS2 node. By default, there is a <code>map_server</code> executable that instances one of these nodes, but it is possible to compose multiple map server nodes into a single process, if desired.</p>
<p>The command line for the map server executable is slightly different that it was with ROS1. With ROS1, one invoked the map server and passing the map YAML filename, like this:</p>
<div class="fragment"><div class="line">$ map_server map.yaml</div>
</div><!-- fragment --><p>Where the YAML file specified contained the various map metadata, such as:</p>
<div class="fragment"><div class="line">image: testmap.png</div>
<div class="line">resolution: 0.1</div>
<div class="line">origin: [2.0, 3.0, 1.0]</div>
<div class="line">negate: 0</div>
<div class="line">occupied_thresh: 0.65</div>
<div class="line">free_thresh: 0.196</div>
</div><!-- fragment --><p>The Nav2 software retains the map YAML file format from Nav1, but uses the ROS2 parameter mechanism to get the name of the YAML file to use. This effectively introduces a level of indirection to get the map yaml filename. For example, for a node named 'map_server', the parameter file would look like this:</p>
<div class="fragment"><div class="line"># map_server_params.yaml</div>
<div class="line">map_server:</div>
<div class="line">    ros__parameters:</div>
<div class="line">        yaml_filename: &quot;map.yaml&quot;</div>
</div><!-- fragment --><p>One can invoke the map service executable directly, passing the params file on the command line, like this:</p>
<div class="fragment"><div class="line">$ map_server __params:=map_server_params.yaml</div>
</div><!-- fragment --><p>There is also possibility of having multiple map server nodes in a single process, where the parameters file would separate the parameters by node name, like this:</p>
<div class="fragment"><div class="line"># combined_params.yaml</div>
<div class="line">map_server1:</div>
<div class="line">    ros__parameters:</div>
<div class="line">        yaml_filename: &quot;some_map.yaml&quot;</div>
<div class="line"> </div>
<div class="line">map_server2:</div>
<div class="line">    ros__parameters:</div>
<div class="line">        yaml_filename: &quot;another_map.yaml&quot;</div>
</div><!-- fragment --><p>Then, one would invoke this process with the params file that contains the parameters for both nodes:</p>
<div class="fragment"><div class="line">$ process_with_multiple_map_servers __params:=combined_params.yaml</div>
</div><!-- fragment --><p>The parameter for the initial map (yaml_filename) has to be set, but an empty string can be used if no initial map should be loaded. In this case, no map is loaded during on_configure or published during on_activate. The <em>load_map</em>-service should the be used to load and publish a map.</p>
<h3><a class="anchor" id="autotoc_md142"></a>
Map Saver</h3>
<p>Like in ROS1 <code>map_saver</code> could be used as CLI-executable. It was renamed to <code>map_saver_cli</code> and could be invoked by following command:</p>
<div class="fragment"><div class="line">$ ros2 run nav2_map_server map_saver_cli [arguments] [--ros-args ROS remapping args]</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md143"></a>
Currently Supported Map Types</h1>
<ul>
<li>Occupancy grid (nav_msgs/msg/OccupancyGrid)</li>
</ul>
<h1><a class="anchor" id="autotoc_md144"></a>
MapIO library</h1>
<p><code>MapIO</code> library contains following API functions declared in <code><a class="el" href="map__io_8hpp_source.html">map_io.hpp</a></code> to work with OccupancyGrid maps:</p>
<ul>
<li>loadMapYaml(): Load and parse the given YAML file</li>
<li>loadMapFromFile(): Load the image from map file and generate an OccupancyGrid</li>
<li>loadMapFromYaml(): Load the map YAML, image from map file and generate an OccupancyGrid</li>
<li>saveMapToFile(): Write OccupancyGrid map to file</li>
</ul>
<h1><a class="anchor" id="autotoc_md145"></a>
Services</h1>
<p>As in ROS navigation, the <code>map_server</code> node provides a "map" service to get the map. See the nav_msgs/srv/GetMap.srv file for details.</p>
<p>NEW in ROS2 Eloquent, <code>map_server</code> also now provides a "load_map" service and <code>map_saver</code> - a "save_map" service. See nav2_msgs/srv/LoadMap.srv and nav2_msgs/srv/SaveMap.srv for details.</p>
<p>For using these services <code>map_server</code>/<code>map_saver</code> should be launched as a continuously running <code>nav2::LifecycleNode</code> node. In addition to the CLI, <code>Map Saver</code> has a functionality of server handling incoming services. To run <code>Map Saver</code> in a server mode <code>nav2_map_server/launch/map_saver_server.launch.py</code> launch-file could be used.</p>
<p>Service usage examples:</p>
<div class="fragment"><div class="line">$ ros2 service call /map_server/load_map nav2_msgs/srv/LoadMap &quot;{map_url: /ros/maps/map.yaml}&quot;</div>
<div class="line">$ ros2 service call /map_saver/save_map nav2_msgs/srv/SaveMap &quot;{map_topic: map, map_url: my_map, image_format: pgm, map_mode: trinary, free_thresh: 0.25, occupied_thresh: 0.65}&quot;</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
